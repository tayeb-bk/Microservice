<div class="edit-report-container">
  <!-- Header -->
  <div class="header">
    <h1>Edit Report</h1>
    <button class="btn btn-secondary" (click)="cancel()">Back to Report</button>
  </div>

  <!-- Loading State -->
  @if (loadingReport) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading report...</p>
    </div>
  }

  <!-- Error Message -->
  @if (error && !loadingReport) {
    <div class="error-message">
      {{ error }}
    </div>
  }

  <!-- Success Message -->
  @if (successMessage) {
    <div class="success-message">
      {{ successMessage }}
    </div>
  }

  <!-- Edit Form -->
  @if (!loadingReport && report) {
    <div class="form-container">
      <form (ngSubmit)="onSubmit()">
        <!-- Report Information Section -->
        <div class="form-section">
          <h3>Report Information</h3>
          
          <div class="form-group">
            <label for="title">Title <span class="required">*</span></label>
            <input 
              type="text" 
              id="title" 
              [(ngModel)]="reportRequest.title"
              name="title"
              class="form-control"
              placeholder="Enter report title"
              required
              maxlength="200">
            <small class="char-counter">{{ reportRequest.title.length }} / 200</small>
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea 
              id="description" 
              [(ngModel)]="reportRequest.description"
              name="description"
              class="form-control"
              rows="4"
              placeholder="Enter report description"
              maxlength="1000"></textarea>
            <small class="char-counter">{{ reportRequest.description?.length || 0 }} / 1000</small>
          </div>

          <div class="form-group">
            <label for="type">Report Type <span class="required">*</span></label>
            <select 
              id="type" 
              [(ngModel)]="reportRequest.type"
              name="type"
              class="form-control"
              required>
              @for (type of reportTypes; track type) {
                <option [value]="type">{{ type }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="generatedBy">Generated By</label>
            <input 
              type="text" 
              id="generatedBy" 
              [(ngModel)]="reportRequest.generatedBy"
              name="generatedBy"
              class="form-control"
              readonly
              disabled>
            <small class="form-text">This field cannot be changed</small>
          </div>
        </div>

        <!-- Report Period Section -->
        <div class="form-section">
          <div class="section-header-with-action">
            <h3>Report Period</h3>
            @if (reportRequest.periodStart || reportRequest.periodEnd) {
              <button 
                type="button" 
                class="btn-link"
                (click)="clearDates()">
                Clear Dates
              </button>
            }
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="periodStart">Period Start</label>
              <input 
                type="datetime-local" 
                id="periodStart" 
                [(ngModel)]="reportRequest.periodStart"
                name="periodStart"
                class="form-control"
                [max]="reportRequest.periodEnd || ''">
            </div>

            <div class="form-group">
              <label for="periodEnd">Period End</label>
              <input 
                type="datetime-local" 
                id="periodEnd" 
                [(ngModel)]="reportRequest.periodEnd"
                name="periodEnd"
                class="form-control"
                [min]="reportRequest.periodStart || ''">
            </div>
          </div>
        </div>

        <!-- Current Status Information (Read-only) -->
        <div class="form-section info-section">
          <h3>Current Status</h3>
          <p class="section-subtitle">Report status information (read-only)</p>
          
          <div class="status-info-grid">
            <div class="info-item">
              <label>Status:</label>
              <span class="badge" [ngClass]="getStatusClass(report.status)">
                {{ report.status }}
              </span>
            </div>
            <div class="info-item">
              <label>Report ID:</label>
              <span>{{ report.id }}</span>
            </div>
            <div class="info-item">
              <label>Created:</label>
              <span>{{ formatDate(report.createdDate) }}</span>
            </div>
            <div class="info-item">
              <label>Last Updated:</label>
              <span>{{ formatDate(report.updatedDate) }}</span>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="loading">
            @if (!loading) {
              <span>Update Report</span>
            }
            @if (loading) {
              <span>Updating...</span>
            }
          </button>
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="cancel()" 
            [disabled]="loading">
            Cancel
          </button>
        </div>
      </form>
    </div>
  }
</div>