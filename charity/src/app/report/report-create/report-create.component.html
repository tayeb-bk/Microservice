<div class="create-report-container">
  <div class="header">
    <h1>Create New Report</h1>
    <button class="btn btn-secondary" (click)="cancel()">Back to Reports</button>
  </div>

  <!-- Toggle between Create and Generate -->
  <div class="form-type-toggle">
    <button 
      class="toggle-btn" 
      [class.active]="!showGenerateForm"
      (click)="showGenerateForm = false">
      Manual Create
    </button>
    <button 
      class="toggle-btn" 
      [class.active]="showGenerateForm"
      (click)="toggleGenerateForm()">
      Auto Generate
    </button>
  </div>

  <!-- Error Message -->
  @if (error) {
    <div class="error-message">
      {{ error }}
    </div>
  }

  <!-- Manual Create Form -->
  @if (!showGenerateForm) {
    <div class="form-container">
      <form (ngSubmit)="createReport()">
        <div class="form-group">
          <label for="title">Title <span class="required">*</span></label>
          <input 
            type="text" 
            id="title" 
            [(ngModel)]="reportRequest.title"
            name="title"
            class="form-control"
            placeholder="Enter report title"
            required>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea 
            id="description" 
            [(ngModel)]="reportRequest.description"
            name="description"
            class="form-control"
            rows="4"
            placeholder="Enter report description"></textarea>
        </div>

        <div class="form-group">
          <label for="type">Report Type <span class="required">*</span></label>
          <select 
            id="type" 
            [(ngModel)]="reportRequest.type"
            name="type"
            class="form-control"
            required>
            @for (type of reportTypes; track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="periodStart">Period Start</label>
            <input 
              type="datetime-local" 
              id="periodStart" 
              [(ngModel)]="reportRequest.periodStart"
              name="periodStart"
              class="form-control">
          </div>

          <div class="form-group">
            <label for="periodEnd">Period End</label>
            <input 
              type="datetime-local" 
              id="periodEnd" 
              [(ngModel)]="reportRequest.periodEnd"
              name="periodEnd"
              class="form-control">
          </div>
        </div>

        <div class="form-group">
          <label for="generatedBy">Generated By</label>
          <input 
            type="text" 
            id="generatedBy" 
            [(ngModel)]="reportRequest.generatedBy"
            name="generatedBy"
            class="form-control"
            readonly
            disabled>
          <small class="form-text">Auto-filled from your Keycloak profile</small>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            @if (!loading) {
              <span>Create Report</span>
            }
            @if (loading) {
              <span>Creating...</span>
            }
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">
            Cancel
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Auto Generate Form -->
  @if (showGenerateForm) {
    <div class="form-container">
      <form (ngSubmit)="generateReport()">
        <div class="form-group">
          <label for="generateType">Report Type <span class="required">*</span></label>
          <select 
            id="generateType" 
            [(ngModel)]="selectedGenerateType"
            name="generateType"
            class="form-control"
            required>
            <option value="DONATION">Donation Report</option>
            <option value="EVENT">Event Report</option>
            <option value="CAMPAIGN">Campaign Report</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="startDate">Start Date <span class="required">*</span></label>
            <input 
              type="datetime-local" 
              id="startDate" 
              [(ngModel)]="generateRequest.start"
              name="startDate"
              class="form-control"
              required>
          </div>

          <div class="form-group">
            <label for="endDate">End Date <span class="required">*</span></label>
            <input 
              type="datetime-local" 
              id="endDate" 
              [(ngModel)]="generateRequest.end"
              name="endDate"
              class="form-control"
              required>
          </div>
        </div>

        <div class="form-group">
          <label for="genGeneratedBy">Generated By</label>
          <input 
            type="text" 
            id="genGeneratedBy" 
            [(ngModel)]="generateRequest.generatedBy"
            name="genGeneratedBy"
            class="form-control"
            readonly
            disabled>
          <small class="form-text">Auto-filled from your Keycloak profile</small>
        </div>

        <div class="info-box">
          <i class="icon-info"></i>
          <p>This will automatically fetch data from the {{ selectedGenerateType.toLowerCase() }} service and generate a comprehensive report for the selected period.</p>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            @if (!loading) {
              <span>Generate Report</span>
            }
            @if (loading) {
              <span>Generating...</span>
            }
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">
            Cancel
          </button>
        </div>
      </form>
    </div>
  }
</div>