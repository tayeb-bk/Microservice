<div class="notifications-container">
  <!-- Header -->
  <div class="notifications-header">
    <div class="header-left">
      <h1>Notifications</h1>
      <span class="notification-count" *ngIf="filteredNotifications.length > 0">
        {{ filteredNotifications.length }} notification{{ filteredNotifications.length !== 1 ? 's' : '' }}
      </span>
    </div>
    <div class="header-actions">
      <!-- Fix: Use a computed property instead of complex expression -->
      <button class="btn-mark-all" (click)="markAllAsRead()"
              [disabled]="!hasUnreadNotifications">
        <span class="icon">‚úì</span>
        Mark All as Read
      </button>
      <button class="btn-clear-all" (click)="clearAllNotifications()"
              [disabled]="notifications.length === 0">
        <span class="icon">üóëÔ∏è</span>
        Clear All
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="notifications-toolbar">
    <div class="filter-buttons">
      <button
        *ngFor="let filter of filters"
        [class.active]="selectedFilter === filter.value"
        (click)="onFilterChange(filter.value)"
        class="filter-btn">
        <span class="filter-icon">{{ filter.icon }}</span>
        {{ filter.label }}
      </button>
    </div>

    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange($event)"
        placeholder="Search notifications..."
        class="search-input">
      <span class="search-icon">üîç</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading notifications...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p>{{ error }}</p>
    <button (click)="loadNotifications()" class="btn-retry">Retry</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && filteredNotifications.length === 0" class="empty-state">
    <div class="empty-icon">üì≠</div>
    <h3>No notifications found</h3>
    <p *ngIf="selectedFilter !== 'all' || searchTerm">
      Try changing your filters or search terms
    </p>
    <p *ngIf="selectedFilter === 'all' && !searchTerm">
      You're all caught up! New notifications will appear here.
    </p>
  </div>

  <!-- Notifications Grid -->
  <div *ngIf="!loading && !error && filteredNotifications.length > 0" class="notifications-grid">
    <div
      *ngFor="let notification of filteredNotifications"
      class="notification-card"
      [class.unread]="notification.status !== 'READ'"
      [class.read]="notification.status === 'READ'"
      [class]="getPriorityClass(notification.priority)">

      <div class="notification-header">
        <div class="notification-type">
          <span class="type-icon">{{ getNotificationIcon(notification.type) }}</span>
          <span class="type-label">{{ notification.type }}</span>
          <span *ngIf="notification.priority" class="priority-badge" [class]="getPriorityClass(notification.priority)">
            {{ notification.priority }}
          </span>
        </div>
        <div class="notification-actions">
          <button *ngIf="notification.status !== 'READ'"
                  (click)="markAsRead(notification)"
                  class="btn-action mark-read"
                  title="Mark as read">
            ‚úì
          </button>
          <button (click)="deleteNotification(notification.id!)"
                  class="btn-action delete"
                  title="Delete">
            √ó
          </button>
        </div>
      </div>

      <div class="notification-body">
        <h4 class="notification-title">{{ notification.title }}</h4>
        <p class="notification-message">{{ notification.message }}</p>
      </div>

      <div class="notification-footer">
        <span class="notification-time">
          {{ formatDate(notification.createdAt!) }}
        </span>
        <span class="notification-status" [class]="'status-' + notification.status?.toLowerCase()">
          {{ notification.status }}
        </span>
      </div>
    </div>
  </div>
</div>
